<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Kho H√¨nh N·ªÅn ƒê·∫πp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Kho chia s·∫ª h√¨nh n·ªÅn ƒë·∫πp mi·ªÖn ph√≠, t·∫£i v·ªÅ d·ªÖ d√†ng, giao di·ªán hi·ªán ƒë·∫°i, hi·ªáu ·ª©ng hoa anh ƒë√†o r∆°i." />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Pacifico&display=swap">
  <style>
    body {
      font-family: 'Quicksand', Arial, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e3f0ff 100%);
      margin: 0;
      padding: 0;
      color: #222;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    header {
      background: rgba(255,255,255,0.97);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 22px 0 10px 0;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .logo {
      font-size: 2.3rem;
      font-family: 'Pacifico', cursive;
      color: #e57373;
      letter-spacing: 2px;
      margin-bottom: 8px;
      display: inline-block;
      font-weight: 700;
      text-shadow: 0 2px 8px #ffeaea;
    }
    .intro {
      font-size: 1.08rem;
      color: #444;
      margin: 0 auto 18px auto;
      max-width: 480px;
      line-height: 1.6;
      font-weight: 500;
    }
    #image-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 18px;
      padding: 0 8px;
      min-height: 120px;
      margin-top: 18px;
    }
    @media (max-width: 600px) {
      #image-container {
        display: grid !important;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        padding: 0 8px;
      }
      .img-card {
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
        flex: unset !important;
        flex-basis: unset !important;
      }
    }
    .img-card {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 14px 10px 10px 10px;
      text-align: center;
      transition: transform 0.18s, box-shadow 0.18s;
      cursor: pointer;
      width: 180px;
      max-width: 45vw;
      border: 1px solid #eaecef;
      position: relative;
      overflow: hidden;
    }
    .img-card:hover, .img-card:focus {
      transform: translateY(-4px) scale(1.04);
      box-shadow: 0 6px 24px rgba(233,30,99,0.13);
      border-color: #e57373;
      z-index: 2;
    }
    .img-card img {
      max-width: 100%;
      max-height: 120px;
      border-radius: 10px;
      box-shadow: 0 1px 4px #ccc;
      transition: box-shadow 0.2s;
      background: #f3f3f3;
    }
    .img-name {
      margin: 10px 0 0 0;
      font-size: 1rem;
      color: #e57373;
      word-break: break-word;
      font-weight: 700;
      font-family: 'Quicksand', Arial, sans-serif;
      letter-spacing: 0.5px;
    }
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin: 32px 0 16px 0;
      flex-wrap: wrap;
    }
    .pagination button {
      background: #e57373;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 7px 16px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
      font-weight: 700;
      box-shadow: 0 2px 8px #ffeaea;
    }
    .pagination button:disabled {
      background: #ffcdd2;
      cursor: not-allowed;
    }
    .pagination span {
      color: #888;
      font-size: 1.1rem;
      padding: 0 4px;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.2s;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content {
      background: #fff;
      border-radius: 22px;
      padding: 28px 18px 18px 18px;
      text-align: center;
      max-width: 95vw;
      max-height: 90vh;
      position: relative;
      box-shadow: 0 8px 32px rgba(233,30,99,0.18);
      animation: modalPop 0.2s;
    }
    @keyframes modalPop {
      from { transform: scale(0.8); }
      to { transform: scale(1); }
    }
    .modal-content img {
      max-width: 90vw;
      max-height: 60vh;
      border-radius: 14px;
      margin-bottom: 14px;
      box-shadow: 0 2px 12px #bbb;
      background: #f3f3f3;
    }
    .modal-actions {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin-top: 12px;
    }
    .modal-actions button, .modal-actions a {
      background: #e57373;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 9px 22px;
      font-size: 1rem;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.2s;
      display: inline-block;
      font-weight: 700;
      box-shadow: 0 2px 8px #ffeaea;
    }
    .modal-actions button:hover, .modal-actions a:hover {
      background: #d32f2f;
    }
    .modal-close {
      position: absolute;
      top: 8px; right: 12px;
      background: none;
      border: none;
      font-size: 2.2rem;
      color: #888;
      cursor: pointer;
      transition: color 0.2s;
    }
    .modal-close:hover {
      color: #e57373;
    }
    footer {
      text-align: center;
      color: #888;
      font-size: 0.98rem;
      margin: 32px 0 18px 0;
      padding-bottom: 8px;
      font-weight: 500;
      letter-spacing: 0.5px;
    }
    @media (max-width: 600px) {
      .img-card { width: 96vw; max-width: 100vw; }
      .modal-content img { max-width: 98vw; max-height: 40vh; }
      .modal-content { padding: 12px 4px 8px 4px; }
      .intro { font-size: 1rem; padding: 0 8px; }
    }
    /* Hoa r∆°i */
    .petal {
      position: fixed;
      pointer-events: none;
      z-index: 99999;
      width: 28px;
      height: 28px;
      background: url('https://cdn.jsdelivr.net/gh/d4m-dev/KhoHinhNen@main/hoa.png') no-repeat center/contain;
      opacity: 0.85;
      animation: fall 6s linear infinite;
    }
    @keyframes fall {
      0% { transform: translateY(-40px) rotate(0deg); }
      100% { transform: translateY(100vh) rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>
    <span class="logo">üå∏ Kho H√¨nh N·ªÅn ƒê·∫πp</span>
    <div class="intro">
      Kho chia s·∫ª h√¨nh n·ªÅn ƒë·∫πp mi·ªÖn ph√≠, t·∫£i v·ªÅ d·ªÖ d√†ng.
  </header>
  <div id="image-container"></div>
  <div class="pagination" id="pagination"></div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content" id="modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <img id="modal-img" src="" alt="" />
      <div class="img-name" id="modal-name"></div>
      <div class="modal-actions">
        <button id="download-btn" type="button">T·∫£i v·ªÅ</button>
        <button id="share-btn">Chia s·∫ª</button>
      </div>
    </div>
  </div>

  <footer>
    &copy; 2025 Kho H√¨nh N·ªÅn ƒê·∫πp. Thi·∫øt k·∫ø b·ªüi d4m-dev.
  </footer>

  <script>
    // Hi·ªáu ·ª©ng hoa r∆°i
    function createPetal() {
      const petal = document.createElement('div');
      petal.className = 'petal';
      petal.style.left = Math.random() * window.innerWidth + 'px';
      petal.style.animationDuration = (5 + Math.random() * 3) + 's';
      document.body.appendChild(petal);
      setTimeout(() => petal.remove(), 7000);
    }
    setInterval(createPetal, 600);

    // Ph√¢n trang
    const PAGE_SIZE = 12;
    let images = [];
    let currentPage = 1;

    function renderImages() {
      const container = document.getElementById("image-container");
      container.innerHTML = "";
      const start = (currentPage - 1) * PAGE_SIZE;
      const end = start + PAGE_SIZE;
      images.slice(start, end).forEach((img, idx) => {
        const card = document.createElement("div");
        card.className = "img-card";
        card.tabIndex = 0;
        card.setAttribute("role", "button");
        card.setAttribute("aria-label", img.name);

        const image = document.createElement("img");
        image.src = img.url;
        image.alt = img.name;
        image.loading = "lazy";
        image.style.opacity = "0";
        image.onload = () => {
          image.style.opacity = "1";
        };

        const caption = document.createElement("div");
        caption.className = "img-name";
        caption.textContent = img.name;

        card.appendChild(image);
        card.appendChild(caption);

        card.onclick = () => openModal(img);
        card.onkeypress = (e) => { if (e.key === "Enter") openModal(img); };

        container.appendChild(card);
      });
      renderPagination();
    }

    function renderPagination() {
      const pag = document.getElementById("pagination");
      pag.innerHTML = "";
      const totalPages = Math.ceil(images.length / PAGE_SIZE);
      if (totalPages <= 1) return;

      const prevBtn = document.createElement("button");
      prevBtn.textContent = "‚Üê Tr∆∞·ªõc";
      prevBtn.disabled = currentPage === 1;
      prevBtn.onclick = () => { currentPage--; renderImages(); };
      pag.appendChild(prevBtn);

      for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage || i === 1 || i === totalPages || Math.abs(i - currentPage) <= 1) {
          const btn = document.createElement("button");
          btn.textContent = i;
          btn.disabled = i === currentPage;
          btn.onclick = () => { currentPage = i; renderImages(); };
          pag.appendChild(btn);
        } else if (i === currentPage - 2 || i === currentPage + 2) {
          const dots = document.createElement("span");
          dots.textContent = "...";
          pag.appendChild(dots);
        }
      }

      const nextBtn = document.createElement("button");
      nextBtn.textContent = "Sau ‚Üí";
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.onclick = () => { currentPage++; renderImages(); };
      pag.appendChild(nextBtn);
    }

    // Modal
    function openModal(img) {
      document.getElementById("modal-img").src = img.url;
      document.getElementById("modal-img").alt = img.name;
      document.getElementById("modal-name").textContent = img.name;

      // T·∫£i v·ªÅ tr·ª±c ti·∫øp
      document.getElementById("download-btn").onclick = function(e) {
        e.preventDefault();
        fetch(img.url)
          .then(response => response.blob())
          .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = img.name;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
          });
      };

      document.getElementById("share-btn").onclick = () => shareImage(img);
      document.getElementById("modal").style.display = "flex";
      document.body.style.overflow = "hidden";
    }
    function closeModal() {
      document.getElementById("modal").style.display = "none";
      document.body.style.overflow = "";
    }
    document.getElementById("modal-close").onclick = closeModal;
    document.getElementById("modal").onclick = function(e) {
      if (e.target === this) closeModal();
    };

    // Chia s·∫ª
    function shareImage(img) {
      if (navigator.share) {
        navigator.share({
          title: img.name,
          text: "Xem h√¨nh n√†y!",
          url: img.url
        });
      } else {
        navigator.clipboard.writeText(img.url);
        alert("ƒê√£ sao ch√©p link ·∫£nh v√†o clipboard!");
      }
    }

    // AJAX l·∫•y ·∫£nh
    fetch("/api/images")
      .then((res) => res.json())
      .then((data) => {
        images = data;
        currentPage = 1;
        renderImages();
      })
      .catch((err) => {
        document.getElementById("image-container").textContent = "L·ªói khi t·∫£i ·∫£nh.";
        console.error(err);
      });
  </script>
</body>
</html>